Рефакторинг ленты истории: https://github.com/Assassinus/yii2-test-refactored-v.2/pull/1

Рефакторинг экспорта: https://github.com/Assassinus/yii2-test-refactored-v.2/pull/2 (извиняюсь, намеренно создал его не в мастер, чтобы удобнее было смотреть(11 файлов вместо 51), т.к. в эту ветку влились изменения из ветки рефакторинга ленты истории, которых нет в мастер)

При поиске решения проблемы с экспортом больших данных было очевидно, что необходимо отойти от удобного, легкоподдерживаемого ActiveRecord в сторону чистого **SQL**, т.к. это узкое место, в котором производительность слишком важна. Также при ознакомлении с кодом библиотеки, генерирующей CSV, стало понятно, что нужно писать кастомный генератор, т.к. внешняя библиотека работает слишком медленно и также является узким местом.
Проанализировал все связи (поля участвующие в выборке) и пришел к выводу, что с индексами все в порядке, кроме одного - **history_object_id_index**, добавив получил еще немного прироста к производительности.

В итоге, после рефакторинга примерно 12к записей выгрузил и отдал в CSV в лучшем случае за 142 мс (в среднем 250 мс), учитывая то, что до рефакторинга аналогичный файл формировался около 30-40 сек, периодически отваливаясь.

В будущем, при еще большем увеличнении нагрузки/объема данных, стоит подумать над тем, чтобы использовать для генерации Threads | Parallel.

Что еще можно сделать:
1. Отрефакторить при необходимости и использовать **ObjectNameTrait** для динамического добавления связей к моделям, взамен объявления связей в моделях
2. Отрефакторить лучше модели, вынести логику и т.д. в отдельные компоненты
3. Внедрить DDD, CQRS подходы. Как минимум обозначить доменную часть и ее сущности
4. Выполнять экспорт используя генераторы/итераторы, чтобы экономить память
5. Отправлять задачу генерации в очередь
6. Написать тесты до рефакторинга, следуя **TDD**

P.S. возможно недопрокинул какие-то данные, но думаю это не так важно, потому как мною делался акцент на построении масштабируемой и высоконагруженной системы
